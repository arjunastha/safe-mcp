title: MCP Agent Code Sabotage via PR
id: 3d2f0e56-44c1-4baf-9e3d-bd9efc3b7c12
status: experimental
description: Detects MCP agent/bot-authored pull requests or commits that introduce risky changes (auth/CI/dependencies/telemetry) indicative of code sabotage.
author: Arjun Subedi (Astha.ai)
date: 2025-11-27
modified: 2025-11-27
references:
  - https://attack.mitre.org/techniques/T1677/
  - https://attack.mitre.org/techniques/T1195/
  - https://attack.mitre.org/techniques/T1554/
  - https://github.com/safe-mcp/techniques/SAFE-T2103
logsource:
  product: mcp
  service: repo_activity
detection:
  selection_pr:
    event_type:
      - pull_request
      - commit
  selection_actor:
    actor_type|contains:
      - agent
      - bot
      - service_account
  selection_risky_files:
    files_modified|contains:
      - "auth"
      - "login"
      - "session"
      - "token"
      - "secrets"
      - "ci.yml"
      - ".github/workflows"
      - "pipeline"
      - "requirements.txt"
      - "package.json"
      - "telemetry"
      - "analytics"
  selection_workflow_unsafe:
    pr_diff|contains:
      - "pull_request_target"
      - "permissions: write-all"
      - "GITHUB_TOKEN"
      - "uses: actions/checkout@"
  selection_new_endpoints:
    pr_diff|contains:
      - "http://"
      - "https://"
      - "ftp://"
  selection_base64:
    pr_diff|contains:
      - "base64"
      - "decode("
      - "ZXh0cmFjdA"  # base64 for 'extract'
  selection_package_scripts:
    pr_diff|contains:
      - "postinstall"
      - "preinstall"
      - "curl "
      - "wget "
      - "bash -c"
  condition: selection_pr and selection_actor and (selection_risky_files or selection_workflow_unsafe or selection_package_scripts or selection_new_endpoints or selection_base64)
falsepositives:
  - Legitimate bot-driven refactors or dependency updates with review
  - Expected CI/telemetry changes during planned upgrades
  - Automated security fixes from trusted bots (dependabot/renovate) after verification
level: high
tags:
  - attack.impact
  - attack.t1195
  - attack.t1554
  - attack.t1677
  - safe.t2103
  - mcp.repo
  - mcp.agent
fields:
  - event_type
  - actor
  - actor_type
  - files_modified
  - pr_title
  - pr_description
  - pr_diff
  - repository
  - branch
  - timestamp
